name: ðŸ§ª Teste Deploy FTP (KingHost)

on:
  workflow_dispatch:  # Permite rodar manualmente pelo GitHub Actions

jobs:
  test-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Criar arquivo de teste
        run: |
          mkdir -p deploy_test
          echo "Deploy automÃ¡tico funcionando em $(date)" > deploy_test/teste_upload.txt

     
      - name: Enviar arquivo via FTPS (modo passivo seguro)
        id: ftps_upload
        continue-on-error: true
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          server: ${{ secrets.KINGHOST_SERVER }}
          username: ${{ secrets.KINGHOST_USER }}
          password: ${{ secrets.KINGHOST_PASSWORD }}
          port: 21
          protocol: ftps
          security: strict
          local-dir: ./deploy_test/
          server-dir: /www/
          timeout: 120
          passive: true
          state-name: none

      
      - name: Fallback para FTP simples (modo passivo)
        if: steps.ftps_upload.outcome != 'success'
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          server: ${{ secrets.KINGHOST_SERVER }}
          username: ${{ secrets.KINGHOST_USER }}
          password: ${{ secrets.KINGHOST_PASSWORD }}
          port: 21
          protocol: ftp
          security: loose
          local-dir: ./deploy_test/
          server-dir: /www/
          timeout: 120
          passive: true
          state-name: none
